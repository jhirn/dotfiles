"use strict";var p=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var N=(r,e)=>{for(var s in e)p(r,s,{get:e[s],enumerable:!0})},x=(r,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of w(e))!S.call(r,n)&&n!==s&&p(r,n,{get:()=>e[n],enumerable:!(t=b(e,n))||t.enumerable});return r};var _=r=>x(p({},"__esModule",{value:!0}),r);var A={};N(A,{default:()=>I});module.exports=_(A);var $=require("child_process");var d=process.platform,l=d==="darwin",c=d==="win32";function O(r){return Buffer.from(r,"utf16le").toString("base64")}var W=`
$result = Get-Process | Where-Object { $_.Id -ne 0 } | ForEach-Object {
  [PSCustomObject]@{
    pid = $_.Id
    name = $_.ProcessName
    cpu = 0
    mem = [math]::Round($_.WorkingSet64 / 1KB, 0)
    path = if ($_.Path) { $_.Path } else { '' }
  }
}
$result | ConvertTo-Json -Compress
`;function f(){return c?`powershell -NoLogo -NoProfile -EncodedCommand ${O(W)}`:"ps -eo pid,ppid,pcpu,rss,comm"}function P(r){let e=r.trim();if(!e)return null;let s=e.match(/(\d+)\s+(\d+)\s+(\d+[.|,]\d+)\s+(\d+)\s+(.*)/);if(!s)return null;let[,t,n,a,o,i]=s;return{id:parseInt(t),pid:parseInt(n),cpu:parseFloat(a),mem:parseInt(o),path:i,processName:i.match(/[^/]*$/)?.[0]??""}}function g(r){try{let e=JSON.parse(r);return(Array.isArray(e)?e:[e]).map(t=>({id:t.pid,pid:0,cpu:t.cpu,mem:t.mem,path:t.path||"",processName:t.name||""}))}catch{return console.error("Failed to parse Windows process output"),[]}}function h(r){if(l)return r.includes(".prefPane")?"prefPane":r.includes(".app/")?"app":"binary";if(c){let e=r.toLowerCase();return e.endsWith(".exe")&&(e.includes("program files")||e.includes("applications"))?"app":"binary"}return"binary"}function y(r,e){return l?r.match(/(?<=\/)[^/]+(?=\.app\/)/)?.[0]:c?e.replace(/\.exe$/i,""):e}var F={maxBuffer:10*1024*1024};async function C(){return new Promise((r,e)=>{(0,$.exec)(f(),F,(s,t)=>{if(s){e(s);return}let a=(c?g(t):t.split(`
`).map(P).filter(Boolean)).filter(o=>o?.processName).map(o=>{let i=o.path||"",m=o.processName||"",u=h(i);return{id:o.id||0,pid:o.pid||0,cpu:o.cpu||0,mem:o.mem||0,type:u,path:i,processName:m,appName:u==="app"?y(i,m):void 0}}).filter(o=>o.processName!=="");r(a)})})}var T=(r,e="mem",s="desc")=>[...r].sort((t,n)=>{let a=t[e],o=n[e];if(a===o)return 0;if(a===void 0)return 1;if(o===void 0)return-1;let i=a<o?-1:1;return s==="desc"?-i:i}),L=(r,e)=>e?.length?r.filter(s=>{let t=`${s.path} ${s.processName} ${s.appName||""}`.toLowerCase();return e.some(n=>t.includes(n.toLowerCase()))}):r,v=(r,e)=>{if(r.length===0&&e?.length)throw new Error(`No processes found matching "${e.join(", ")}"`)};async function I(r){let e=await C(),s=L(e,r?.searchTerm);return v(s,r?.searchTerm),T(s,r?.sortBy,r?.sortOrder)}
